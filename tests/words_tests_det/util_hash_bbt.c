/*
 * This version uses the my new hash.
 *
 * Read stdin line by line and hash it. Write the hash and the input to stdout.
 */

#include <stdint.h>
#include <stdio.h>
#include <string.h>
#include "hash_bbt.h"

#if BBT_HASH_WIDTH == 64
struct bbt_hash_patterns bbt_table = {
  .hashPatternsSize = 37, //NOLINT
  .hashPatterns = (bbt_hash_t[]){
    0x21EE13B6B0EAA639ul, //NOLINT
    0x51F4395A5AA38DC6ul, //NOLINT
    0xEC70A24FA1F2F126ul, //NOLINT
    0x14F65C9ADD4241F5ul, //NOLINT
    0x43753965E562E5C8ul, //NOLINT
    0xF2986CE2D8A5CA47ul, //NOLINT
    0x64CEE0AE7A8A097Bul, //NOLINT
    0x6C2713976C9C28F3ul, //NOLINT
    0xFC143A69D706D919ul, //NOLINT
    0x63F08E5C562DB30Bul, //NOLINT
    0x770588FC169EA26Dul, //NOLINT
    0xD3C483DAAF821DD8ul, //NOLINT
    0x21EE2DD267490B9Eul, //NOLINT
    0xCA4D4AE39578EE0Aul, //NOLINT
    0x56472E74B84706BEul, //NOLINT
    0x968E34CE327616F4ul, //NOLINT
    0x26EC2F68A12F3587ul, //NOLINT
    0xF132B8534CF8C54Bul, //NOLINT
    0x3F28A89BBDC059ACul, //NOLINT
    0xAD8CB8746F185947ul, //NOLINT
    0xADC4F2A122DBE269ul, //NOLINT
    0x6E136F229E94A791ul, //NOLINT
    0x58CDC1E3E9344E99ul, //NOLINT
    0x1F34BB0C2DC6B817ul, //NOLINT
    0xA876A7A26C6A5369ul, //NOLINT
    0x686EE9522B4BE0F4ul, //NOLINT
    0x6786EAE044DBB09Bul, //NOLINT
    0x1C7363D1A0F6C95Cul, //NOLINT
    0xC4CE2CCB552B878Dul, //NOLINT
    0x5CA5B6B0FAA0C66Cul, //NOLINT
    0xE81BDD50BE3052DAul, //NOLINT
    0x80FB5B9443E9127Bul, //NOLINT
    0xC7C8F944AACCB516ul, //NOLINT
    0x865E686BC3A61DD1ul, //NOLINT
    0x351D38E3998BEA07ul, //NOLINT
    0x513D710F87C92B71ul, //NOLINT
    0x7C91932E56631BF0ul, //NOLINT
  },
  .commandPatternsSize = 41, //NOLINT
  .commandPatterns = (bbt_hash_t[]){
    0x7515A54B52CD64E9ul, //NOLINT
    0x94572F252AEA196Bul, //NOLINT
    0xE1E2A2D31E2E34A7ul, //NOLINT
    0xF70152BA9A3559CAul, //NOLINT
    0x079E2D728B35F503ul, //NOLINT
    0xE56862D6B8D4251Ful, //NOLINT
    0x076E38F868E9A2F4ul, //NOLINT
    0xF816B946076E8F0Eul, //NOLINT
    0x29BAC69C467CCEC4ul, //NOLINT
    0xE073D6640E5B1D1Dul, //NOLINT
    0x6BC13C369B130F4Dul, //NOLINT
    0xB8172E724CDC8573ul, //NOLINT
    0xE552659C534B734Cul, //NOLINT
    0x75D0C0D7C7A46783ul, //NOLINT
    0x4D726E15A7E0DD81ul, //NOLINT
    0xE926DCE0819F78A9ul, //NOLINT
    0xCD167534A6C3515Eul, //NOLINT
    0x33172FC8E1693734ul, //NOLINT
    0x47E160AF6CE8B54Aul, //NOLINT
    0x44CFDE82B6075EC4ul, //NOLINT
    0x57492C97B2C52E87ul, //NOLINT
    0x26BCF5426535683Bul, //NOLINT
    0x869789EAD32C9336ul, //NOLINT
    0x9A8BE4938BB89A6Aul, //NOLINT
    0x691EFC828D9AC64Eul, //NOLINT
    0x68D68C6B09EB526Eul, //NOLINT
    0x65D2AC392D4D2BB1ul, //NOLINT
    0x4EE495D459A9C63Cul, //NOLINT
    0x578998D9E3A1D6A1ul, //NOLINT
    0x03DB9363453BA396ul, //NOLINT
    0x1EB1782BE46C385Eul, //NOLINT
    0x6ED08CE9F0AC832Ful, //NOLINT
    0xDA4A55C6CEC8D592ul, //NOLINT
    0xAC695B58FA11DD41ul, //NOLINT
    0x9F05BB30BA0E7C85ul, //NOLINT
    0xF129361B349EE646ul, //NOLINT
    0x8CCE9DA881DD235Bul, //NOLINT
    0xE9C4077964EC8C97ul, //NOLINT
    0x6B2C2B781B5AB86Cul, //NOLINT
    0xC32DE2D889373363ul, //NOLINT
    0xA2B6F81C8A97F851ul, //NOLINT
  }};
#endif

#define STR_BUFFER_SZ 512

int main(int argc, char **argv) {
	bbt_hash_t hash;
	char b[STR_BUFFER_SZ];
	bbt_hash_ctxt hc;

	bbt_hash_init(&hc, &bbt_table);

	while (fgets(b, STR_BUFFER_SZ-1, stdin)) {
		unsigned n = strlen(b);
		b[n-1] = 0;
		bbt_hash_calc(&hc, (unsigned char *)b, strlen(b));
		hash = bbt_hash_getHash(&hc);
		printf("%016lX\t%s\n", hash, b);
		bbt_hash_reset(&hc);
	}

	return 0;
}

